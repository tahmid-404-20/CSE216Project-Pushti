<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>
    <title><%= locals.title%></title>
    <link rel="icon" type="image/png" href="/images/logo_caption_sm.png" />
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />
    <style>
      .card-registration .select-input.form-control[readonly]:not([disabled]) {
        font-size: 1rem;
        line-height: 2.15;
        padding-left: 0.75em;
        padding-right: 0.75em;
      }
      .card-registration .select-arrow {
        top: 13px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <img
          src="/images/logo_caption_sm.png"
          style="width: 100px; height: 100px"
          alt="logo"
        />
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarColor01"
          aria-controls="navbarColor01"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="/agent"
                >Home
                <span class="visually-hidden">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a id="gotoRequests" class="nav-link" href="/agent/requests"
                >Requests</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/agent/register-buyer"
                >Register a Buyer</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/buyproducts">Buy Products</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/sellproducts">Sell Products</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/inventorystatus"
                >Inventory Status</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/buyhistory">Buy History</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/sellhistory">Sell History</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/agent/sendfeedback">Send Feedback</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/logout">Log Out</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="h-100" style="background-color: darkgray">
      <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col">
            <div class="card card-registration my-4">
              <div class="row g-0">
                <div class="col-xl-6 d-none d-xl-block">
                  <img
                    id="register-side-image"
                    src="/images/reg_login_sideImage.jpg"
                    alt="Sample photo"
                    class="img-fluid"
                    style="
                      border-top-left-radius: 0.25rem;
                      border-bottom-left-radius: 0.25rem;
                    "
                  />
                </div>
                <div class="col-xl-6">
                  <div class="card-body p-md-5 text-black">
                    <h3 class="mb-5 text-uppercase" style="color: aliceblue">
                      Pushti - Buyer Registration
                    </h3>
                    <div
                      class="alert alert-dismissible alert-success"
                      id="success"
                      style="display: none"
                    >
                      <button
                        type="button"
                        class="btn-close"
                        onclick="cls2()"
                      ></button>
                      Registration successful!
                    </div>
                    <form
                      id="buyer-registration-form"
                      method="post"
                      action="/agent/register-buyer/process-register"
                    >
                      <div class="row">
                        <div class="col-md-6 mb-4">
                          <div class="form-outline">
                            <input
                              type="text"
                              id="firstname"
                              name="firstname"
                              class="form-control form-control-lg"
                              placeholder="First Name"
                              required
                            />
                            <p
                              style="
                                text-align: center;
                                color: red;
                                font-family: cursive;
                              "
                              id="firstnameError"
                              class="ermas"
                            ></p>
                          </div>
                        </div>
                        <div class="col-md-6 mb-4">
                          <div class="form-outline">
                            <input
                              type="text"
                              id="lastname"
                              name="lastname"
                              class="form-control form-control-lg"
                              placeholder="Last Name"
                              required
                            />
                            <p
                              style="
                                text-align: center;
                                color: red;
                                font-family: cursive;
                              "
                              id="lastnameError"
                              class="ermas"
                            ></p>
                          </div>
                        </div>
                      </div>
                      <div class="form-outline mb-4">
                        <input
                          type="number"
                          id="nid"
                          name="nid"
                          class="form-control form-control-lg"
                          placeholder="NID No"
                          required
                        />
                        <p
                          style="
                            text-align: center;
                            color: red;
                            font-family: cursive;
                          "
                          id="nidError"
                          class="ermas"
                        ></p>
                        <div
                          class="alert alert-dismissible alert-danger"
                          id="errormsg"
                          style="display: none"
                        >
                          <button
                            type="button"
                            class="btn-close"
                            onclick="cls()"
                          ></button>
                          Buyer already registered!
                        </div>
                      </div>

                      <div class="form-outline mb-4">
                        <label
                          class="form-label"
                          for="dob"
                          style="color: aliceblue"
                          >Date of Birth</label
                        >
                        <input
                          type="date"
                          id="dob"
                          name="dob"
                          placeholder="DOB: DD-MON-YYYY e.g 01-FEB-1990"
                          class="form-control form-control-lg"
                          required
                        />
                      </div>

                      <div class="form-outline mb-4">
                        <input
                          type="number"
                          id="phoneNo"
                          name="phoneNo"
                          class="form-control form-control-lg"
                          placeholder="Eleven Digit Phone No"
                          required
                        />
                        <p
                          style="
                            text-align: center;
                            color: red;
                            font-family: cursive;
                          "
                          id="phoneNoError"
                          class="ermas"
                        ></p>
                      </div>

                      <div class="d-flex justify-content-end pt-3">
                        <button
                          id="reset"
                          type="button"
                          class="btn btn-light btn-lg"
                        >
                          Reset all
                        </button>
                        <button
                          id="submit"
                          type="submit"
                          class="btn btn-warning btn-lg ms-2"
                        >
                          Submit form
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script>
      function cls() {
        document.getElementById("errormsg").style.display = "none";
      }

      function cls2() {
        document.getElementById("success").style.display = "none";
      }

      document.getElementById("reset").onclick = function () {
        var elements = document.getElementsByTagName("input");
        for (var ii = 0; ii < elements.length; ii++) {
          if (
            elements[ii].type == "text" ||
            elements[ii].type == "number" ||
            elements[ii].type == "date"
          ) {
            elements[ii].value = "";
          }
        }
        let all = document.getElementsByClassName("ermas");
        for (let i = 0; i < all.length; i++) {
          all[i].innerHTML = "";
        }
      };

      function resetPage() {
        var elements = document.getElementsByTagName("input");
        for (var ii = 0; ii < elements.length; ii++) {
          if (
            elements[ii].type == "text" ||
            elements[ii].type == "number" ||
            elements[ii].type == "date"
          ) {
            elements[ii].value = "";
          }
        }
        let all = document.getElementsByClassName("ermas");
        for (let i = 0; i < all.length; i++) {
          all[i].innerHTML = "";
        }
      }

      const sampleForm = document.getElementById("buyer-registration-form");
      //Add an event listener to the form element and handler for the submit an event.
      sampleForm.addEventListener("submit", async (e) => {
        /**
         * Prevent the default browser behaviour of submitting
         * the form so that you can handle this instead.
         */
        // e.stopImmediatePropagation();
        let all = document.getElementsByClassName("ermas");
        for (let i = 0; i < all.length; i++) {
          all[i].innerHTML = "";
        }
        e.preventDefault();
        /**
         * Get the element attached to the event handler.
         */
        let form = e.currentTarget;
        let url = form.action;

        try {
          /**
           * Takes all the form fields and make the field values
           * available through a `FormData` instance.
           */
          let formData = new FormData(form);

          let formDataObject = Object.fromEntries(formData.entries());

          // Format the plain form data as JSON
          // let formDataJsonString = JSON.stringify(formDataObject);
          document.getElementById("errormsg").style.display = "none";
          document.getElementById("success").style.display = "none";
          postData(url, formDataObject).then((data) => {
            console.log(data); // JSON data parsed by `data.json()` call
            if (data.error) {
              document.getElementById("errormsg").style.display = "block";
            } else if (data.errors) {
              for (let x in data.errors) {
                document.getElementById(x + "Error").innerHTML =
                  data.errors[x].msg;
              }
            } else {
              resetPage();
              document.getElementById("success").style.display = "block";
            }
          });

          /**
           * The `postFormFieldsAsJson()` function in the next step.
           */
        } catch (error) {
          //If an error occurs display it in the console (for debugging)
          console.error(error);
        }
      });

      async function postData(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
          method: "POST", // *GET, POST, PUT, DELETE, etc.
          mode: "cors", // no-cors, *cors, same-origin
          cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
          credentials: "same-origin", // include, *same-origin, omit
          headers: {
            "Content-Type": "application/json",
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          redirect: "follow", // manual, *follow, error
          referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
          body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
      }
      /**
       * Helper function to POST data as JSON with Fetch.
       */
      async function postFormFieldsAsJson({ url, formData }) {
        //Create an object from the form data entries
        let formDataObject = Object.fromEntries(formData.entries());
        // Format the plain form data as JSON
        let formDataJsonString = JSON.stringify(formDataObject);

        //Set the fetch options (headers, body)
        let fetchOptions = {
          //HTTP method set to POST.
          method: "POST",
          //Set the headers that specify you're sending a JSON body request and accepting JSON response
          headers: {
            "Content-Type": "application/json",
            Accept: "application/xhtml+xml",
          },
          // POST request body as JSON string.
          body: formDataJsonString,
        };

        // Get the response body as JSON.
        // If the response was not OK, throw an error.
        let res = await fetch(url, fetchOptions);

        //If the response is not ok throw an error (for debugging)
        console.log(res.body);
        if (!res.ok) {
          let error = await res.text();
          throw new Error(error);
        }
        //If the response was OK, return the response body.
        return res.json();
      }
    </script>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
